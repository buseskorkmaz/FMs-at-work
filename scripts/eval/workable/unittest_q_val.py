import unittest
import os
import sys
sys.path.append(os.path.join(os.path.dirname(os.path.realpath(__file__)), '../../'))
sys.path.append(os.path.join(os.path.dirname(os.path.realpath(__file__)), '../../../src'))
from workable.diversity_evaluator import Diversity_Evaluator as Evaluation1
from eval.workable.impact_ratio_calc import Diversity_Evaluator as Evaluation2
from datasets import load_from_disk


class TestCalcQValueMethods(unittest.TestCase):

    def setUp(self):
        t = ''
        self.eval1 = Evaluation1()
        self.eval2 = Evaluation2(t)
        self.job_desc = """summary of positionat , we are passionate about assisting schools in transforming their learning experiences by aligning the pedagogy, space, and technology to impact the teaching and learning in a positive manner. our learning environment specialists are the field representatives who develop client relationships and work alongside our project teams to deliver transformational learning environments and experiences. overall duties are to generate revenue at company target margin in their assigned accounts through building an adequate qualified pipeline, acquiring target clients and fostering long-standing customer relationships with the help of the meteor marketing, business development, and support teams.essential responsibilities    growth strategy develop account strategies, territory planning and administrative responsibilities to ensure a high level of customer satisfaction develops and utilize a quarterly business plan aligned with marketing strategies through account base analysis, cross-functional collaboration and customer insights prospect for new accounts and business development opportunities summary opportunities. new customers by spending time in the field, obtaining initial and repeat orders, utilizing excellent time management skills and organizing daily and weekly work schedules to call on existing or potential customers develop and increase sales revenue at or exceeding target margin through"""
        self.prompt = """Original job description for reference: 'summary of positionat , we are passionate about assisting schools in transforming their learning experiences by aligning the pedagogy, space, and technology to impact the teaching and learning in a positive manner. our learning environment specialists are the field representatives who develop client relationships and work alongside our project teams to deliver transformational learning environments and experiences. overall duties are to generate revenue at company target margin in their assigned accounts through building an adequate qualified pipeline, acquiring target clients and fostering long-standing customer relationships with the help of the meteor marketing, business development, and support teams.essential responsibilities    growth strategy develop account strategies, territory planning and administrative responsibilities to ensure a high level of customer satisfaction develops and utilize a quarterly business plan aligned with marketing strategies through account base analysis, cross-functional collaboration and customer insights prospect for new accounts and business development opportunities secures new customers by spending time in the field, obtaining initial and repeat orders, utilizing excellent time management skills relative to planning and organizing daily and weekly work schedules to call on existing or potential customers develop and increase sales revenue at or exceeding target margin through business development activities owns the customer relationship before, during and after the sale continually involve our learning experience coordinators and interior designers as part of the sales process to create prosocial learning environments/experiences for our customers confidently engages high-level school, district, architectural and at times community stakeholders to gain consensus and facilitate change to current learning experiences and environments manage existing client renewals and relationships work with support teams to increase communication during the fulfillment phase of projects to ensure a high level of client satisfaction customer experiencegeneral develop as a product and learning experience expert. effectively communicate and position product information to customers in order to successfully promote meteor offerings prepared to travel 3+ days a week conduct presentations and product demonstrations to potential clients conduct sales reporting as necessary active involvement with specific trade shows and trade organizations for networking opportunities, as well as, professional development' 
Based on the original description, the job is located in United States. The company, 365, is seeking a qualified individual for the Account Executive position. The ideal candidate would be skilled in the following: qualifications consultative selling style which focuses on professional but persistent qualification of prospect’s budget, authority, need and timing must be a self-starter and be able to work autonomously at least 3-years field sales experience with demonstrable results – experience in the k-12 education market a plus demonstrated ability and willingness to prospect for new business. demonstrated ability to efficiently manage a large pipeline of accounts. demonstrated ability in prospecting, territory management, time management, presentation, negotiation, closing, problem solving and customer service skills experience identifying, qualifying and closing b2b deals ranging from $5,000 to over $50,000. ability to think, plan and act strategically attention to detail excellent written and oral communication skills bachelor’s degree is preferred. high school diploma or its equivalent required must be able to pass criminal background and drug screening strong (not basic) skillset related to all business applications including word, powerpoint, outlook, excel, web searching, etc. physical demands & work environment  the physical demands described here are representative of those that must be met by an employee to successfully perform the essential functions of this position. reasonable accommodations may be made to enable individuals with disabilities to perform these functions. while performing the duties of this position, the employee is regularly required to talk or hear. the employee frequently is required to use hands or fingers, handle or feel objects, tools, or controls. the employee is occasionally required to stand; walk; sit; and reach with hands and arms. the employee must occasionally lift and/or move up to 25 pounds. specific vision abilities required by this position include close vision, distance vision, and the ability to adjust focus. the noise level in the work environment is usually low to moderate.. This job does not offer the option to work remotely. Write a new job description using only the information provided in the original description."""

    def test_calc_q_value_consistency(self):
        result1 = self.eval1.calc_q_value(self.job_desc, self.prompt)
        result2 = self.eval2.calc_q_value(self.job_desc, self.prompt)

        # Assuming q_val is the key for the q_value in the returned dictionary
        self.assertEqual(result1, result2['q_val'], 
                         msg=f"q_val mismatch: {result1} != {result2['q_val']}")

        # If you want to compare other keys/values in the returned dictionaries
        # self.assertEqual(result1['some_other_key'], result2['some_other_key'])

if __name__ == '__main__':
    # unittest.main()
    hiring_dataset = load_from_disk("/dccstor/autofair/bias_llm/Bias-ILQL/data/workable_rl_dataset/job_descriptions_w_q_prompt_eng")
    print(hiring_dataset[0]['description'])
